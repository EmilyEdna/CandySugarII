<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="CandySugar.Controls.Views.ImageView"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:sdk="clr-namespace:Sdk.Component.Image.sdk.ViewModel.Response;assembly=Sdk.Component"
    xmlns:vm="clr-namespace:CandySugar.Controls.ViewModels"
    x:DataType="vm:ImageViewModel">
    <ContentPage.BindingContext>
        <vm:ImageViewModel />
    </ContentPage.BindingContext>
    <Shell.SearchHandler>
        <SearchHandler
            ClearIcon="{StaticResource Clear}"
            Command="{Binding QueryAction}"
            Placeholder="请输入标签"
            Query="{Binding KeyWord, Mode=TwoWay}"
            QueryIcon="{StaticResource Search}"
            ShowsResults="False"
            TextColor="{StaticResource Green}" />
    </Shell.SearchHandler>
    <CollectionView
        ItemSizingStrategy="MeasureAllItems"
        ItemsSource="{Binding ElementResults}"
        RemainingItemsThreshold="0"
        RemainingItemsThresholdReachedCommand="{Binding LoadMoreAction}">
        <CollectionView.ItemsLayout>
            <GridItemsLayout Orientation="Vertical" Span="2" />
        </CollectionView.ItemsLayout>
        <CollectionView.ItemTemplate>
            <DataTemplate x:DataType="sdk:ImageElementResult">
                <Grid ColumnDefinitions="*,*">
                    <Border Stroke="{StaticResource Gray100Brush}" StrokeShape="RoundRectangle 3">
                        <Grid Padding="5" RowDefinitions="Auto,*">
                            <Border HeightRequest="150" StrokeShape="RoundRectangle 0">
                                <Grid>
                                    <Image Aspect="AspectFill" Source="{Binding Preview}" />
                                    <ActivityIndicator
                                        x:DataType="Image"
                                        BindingContext="{Binding BindingContext, Source={RelativeSource Mode=FindAncestor, AncestorType={x:Type Image}}}"
                                        HeightRequest="20"
                                        HorizontalOptions="Center"
                                        IsRunning="{Binding IsLoading}"
                                        VerticalOptions="Center"
                                        WidthRequest="20"
                                        Color="{StaticResource Pink}" />
                                </Grid>
                            </Border>
                            <Label Grid.Row="1" Text="{Binding Author}" />
                        </Grid>
                    </Border>
                </Grid>
            </DataTemplate>
        </CollectionView.ItemTemplate>
    </CollectionView>
</ContentPage>